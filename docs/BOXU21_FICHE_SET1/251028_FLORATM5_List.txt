subroutine adummy
Grrevvy Gllehe storage set up tere

cllehe param

parameter (112x266, Jrexs30, lzx2sizx-2 )

parameter ( [tbweokizx=1

pdrameter (kKxpsllzxe2)e(jrx-2), tbwsteax-t )

parameter (nplt#3000, npset00 |)

parameter (lxpfsdeltzx-2) .nfourxfs#150)

parameter (IxpgFretizx2)

pardmeter (ksime51 |

endeliche

eliche fstor

use param
common/fun/filltzx jrel fallax, Jexl, f3ltzx, pred, fal tex, jrx
qe .fFBltex fred f7Clex jexd, .
ec gtllex jew) , geltzx, Jew) gSlizx,jrul galizex, drx)
¢ ,$wgl,swge,swg3,swgd

common/equill/b(tzx,Jrx) rholtzx,jerx),qublizx jee) er l(lex, rx)
¢ ,phti (tex, Jexbiyyyltex, jew) xxxltex jrwulravitzx, rx)
cammon/pertur/xioalkxp)  xlolkxpl, xlol(kxp!)
¢ ,xroolkxpl],xrolkxp), xrolikxp!]

erdcliche

cliche matrix

use param

common/coeff/al(hap. 9) ,adtkxp, 9) ,adikxp, 9) bi (kxp, 3)
e ,thsl(kxp) rhse2lkxp)

Greverstinnamed common for dynamic memeory expansion
common wwlll, wwil(ll)
endeliche

ellche const

use param

comman/title/aname(5)
common/con/gami,gam2,ix,Jx,mm,tzxp, Kxx,nmax, |max,isw, thbw

¢ ,fact, face, blas,du,dv,dt,ndtag,ex0,bO,rhoO,exl fil. fizx,fj1
c ,fjrx,kplot,npm.fpst,fz,fu,fv,azm,apsim,u0,v0O,amass

c ,fourp!,omegst,omegr ,omegexb, fir, sf6,sfB,kKplotm,kzs, zedge

e ,cpuo,clo,syso,valfk,xu,xvin,pl,vwiostwidvin,dvout

common/contm/
psiOrel, ,psitrel,pstdrel,zirel,z2rel,z3rel,z0rel,nslash,bmg
incenter pslosh,pcenter,rp,ztrans, ltrans,bm,ltran,ztran rp]
rbcen, pring, epsp, phicen,phiplg Kin, xpot, ypot,wpot ,pfudge,rpx
iphice,phipl betsish, betcent,20,21,22,23,24,psil,psi2,psi0
rbetcene,betsise, psloshe, pcentee,bmax,alsi,bml,psisl,cold
ipewide, psidsrel  psi3,pimax,bv0,6v3,b44,bceng, psloshin,psloshen
insloshin,pxp)],pxp2,p3d,p3b.p3c pad, psim,petO,aet,bel,cel
pstOerel psi 2,psime,p2ewide, woe

common/mesh/psil(jrx),zlizxl,ulizx),vijrx),dpstljrxu) ,dzl(tzx)

¢ ,vpsi(jrx) uuzlizx) ,vpsth(jrxl,uuzhlizx)
common/graf/ xrtime(nplt) xrspzlizx,nps),xrsppsiljrx,2%nps |

c ,time(nplt), xflute(izx,nps!
common/curveo/er, lb,rw,beta0,delrho,stable,en0,cee,rO,

c echarg,omeg!,omeg2,en! ,besarg,zol,dtrel,p0,omegO

¢ ,amanat,omana2, groana, thetad
common/tmeon/hlaltizx) Atltzx) h34lizx«) ,abplizx) ,bbplizx)

¢ ,cbp(tzx),abflizx) bbflizx) ,cbflizx) ,hp3ljrx) ,hptleljrx!

e ,htrans(tzx) ,abqlizx)] bbqlizx) ,cbqlizx) h56(tzx) ,abr(itzx])

aoa n aan n

a

Ga

onandn

Go

ao 0

on 0

4

noo a on

a a ee ac

rann

G

rs

enonananan

e* eet

brea

eh age

sober (tax) cbr (tzx) betring hpOljex) hpm(jrx!l, hpme(jrx)
common/tmfleld/bvacl(izx) ,dbvdzlizx) ,dabvde2lizx) ,dpldpstljrvr)
ipPllirx) ptkikstim, Jex) bpklatksim) ApkO(kstm) ,deltiiksitm!
deli2(ksim) delidiksim) delidi(ksim) .r2zz(tzx,jrx)  dbdpsit(tzx,jrx])
phit(tzxl phi2lizx) pperplizx,jerxl, ppartizx,jexl dflute3ltzx)
qubvitax,Jerx) peljrx) dpadpstljrx) dflutet(izx),dflute2(izx)
rflutet(jrxl fluted(jrx) fluted(jrx) pakiksim,jrxl delitS(ksim)
pperps(tzx ,jrxlverrprp(tzx,jrx),errprl(tzx2,jrx-1)
pperpel(tzx,Jrx) ,epstli2ex,jrxi,omegiwkbl jr), omegewkbl jr!
gamwikbljrx)l ,dfluted(tzx) ,rhoaveljrul,xxxaveljrx)l,yyyaveljrx]
petljrxl dpedpet(jrxl p3ljrxu) dp3dpstljrx) hpkm(ksim)
shpkme(ksim)

common/forzed/nfour ,nfourx,nfourmax,nfourp,} four, ixp, tocy

real lb, ltrans, I tran ,nslosh,ncenter ,nsloshin

endeliche

return
end

the main routine

notice of 4/8/82, this verston runs correctly for tsw2t, and
runs correctly for Iswa-7 ,

1444+ 9712/82, flora runs testcase 1 , 0 beta, O pressure, homogeneous

bob ee

-_— = - * -
. “ -_ +
-_— -— -
a ae a

#4 ead

ow

‘

- -_ - 2 «

+ @ © #& ¢

ee eae

$e © be

oe 4

$e 4 ee

# + # @ @

plasma, correctly,

floral transforms variables z,pst to u,v which are always equally
spaced, transformation! zzautut*xu, and pst=apsikveexv, where
zmax=umax, psimaxeymax, and fz¥zmax=futumax, fposttpsimaxsfvevmax

fz, fu, fosl, fv, Input, xutln fz / In fu, xveln fpsi / In fu,
ausumaxe¥(=xxt1) , apsl=vmaxtel(-yyet) ,

flora2 solves test case 2 , rotating rigid rotor stability, ref!
freidberg and pearlistein, phys fluids 2717) july 1978 1207
flora4 tncludes background constant density, enbar ( as does flora3

l,

and Kkzs switch which when set to zero, generates [initial perturbations

independent of z In random spatial generator (ex0=1,)

florad
Is vectortzed version of florad, (calls rightvec instead of
right }, also has timing routine from b, langdon (requires

bzohar loaded as a binary |}.

+, Insert cliche storage here

flora7 ts mod. floradS, with psi stretching function
exactly centered in amat. (flora5 used linear tnterpolation
to get vosilj+1/2)). Also revised diagnostic plots tncluded.

floral2 is florall (rigid rotor with corrected equil, and
corrected curvature terms (floral0)) with fourter mode analyses
added ( using cpft and rpft) and data for zed post processing.

wees Additional input data! jJfour (v Index at which xr ts analyzed in
z }, nfourp ({ analyze xr every nfour’th time step |}, nfourmax
(number of times the buffer is read to the history file), note

onn nan anndnnn

ano

no n

oeann A

reves &P TS extended a factor of 4 to look like a periodic full wave
reene for ecpft. Tf Jfour ts trput 0, code sets it to jx/4 ,
veveaefloral3 is floral2 with curvature driven flute mode equt librium
rere s lequilrot replaced by equtlcur, rigidcon replaced by curvecon }
reveafloratm, tandem mirror equilibrium
reese flortm?, tandem mirror equilibrium, with 3-d plot of equilib,
quantities added, ( uses tv80 and graflib |
rovers flortex, tandem mirror equilb., with corrections to flortm!., In-
reeeee PUt Switches swg1l, swg92, swg3, swg4 added,
reveaflortm2, Like flortex with revised electron ring, a la D'ippolito
veaee ferring pperp In b fleld only, and additional term in curvature
tebe drive |,
receeflortm3, like flortm2 with corrections to pressusre normalization,
renee And additional diagnostics. ( 3-d plots of curvature drive-e ring
,eae term, and perp. pressure balance check ) , also 3-d plots of
voee PPArallel pressure check, and e-psi (=-dphi/dpsi |} , Phi2 modified

poeee to = JT, -(pst/psid)etyeot

reese flortm4, modified plasma pperp with addition of p3lj} to give
wees &@ posttive slope near the center,

seveeflortm5, modified pt in flortm4 to be two functions, pel and
seven Pe2, jotned at psime with equal slope and value.pel=ael+bei*(
weeee PSI/psimeltcel*lpst/psimel**#2, and pe2=,5k(1-tanhl (psi-psidel/p2ewide) |
use param
use fstor
use matrix
use const

data t' ‘ @6/

integer tallyb{(2000b)
commen / qBliocs/iocf (0:15)
common/piclO00/npete

data jtally/1/

veees  COlT Link call here
call Link ’unitS9=terminal ,unit2=l(inf ltm4, open! ,unit3=(output,
c create! //')

if(ttally.gt,0O) then
do 200 it#1,15
200 tfliocfltil.eq.Olgo to 210

1i#O
210 toctally=tt
joctally=14

tflioctally.eq.Qlgo to 299

call timerlioctally, ’ztally0Q0Q°,tallyb,2000b,floratim,1)
299 itally=-1

endif

tsw=]

iflizx.gt.jrxlisw=-1

jtbw= S¥(1+iswltitbwe S#(l-iswl*(2kjrx.-1)

thbw=,5e(1+iswitibw+  Se(1-iswl*¥ljrx-1)

nn=jtbwtkxp

¢
c

Cs

eevee

+ # be ae

20
930

100

nnl=jtbwtkxp

call merorylww,nn-t)
cal! memorylwawtinn) nant
call pstartidey 4rplot,1,'box u21$',1)
npete=1

call 100

call input

call inputtm

call rigtdcon

call curvecon

call grid

call constant

call tmcon2

call equiltm

call equilrot

call equileur

call filtol}

call amat

call comatlww,jtbw)

call tnitial

special version for testing fourter analysts and zed file
maker

call fourplay

call fourier

call mymovelxrol(1),xroll)  Kxx)
call mymovelxiol(1),xiolt),kKxx)
call mymovel(xroolt),xrolt)  Kxx!
call mymovelxtoo(1),xfoll) ,kxx)
call banfactkxp, ihbw,ww,1,-(kxp-1))
t=0,

do 100 n=1,nmax

t=t+dt

timel(n)=t

facl=-1 /dt

fac2=1,/dt

do 90 1=0, lmax

call rightvec

call zmovewrdlwwi(nn! rhst.kxx)

call bansol(kxp, thow,ww,1,-(Kxp-1) .wwtinn))
do 10 je2,jx-1

kKp=l¢tzxpx(j-2)

call zmovewrdlxrol,wwllnan) ,kKxx!
continue
call zmovewrd(wwi (nn) .rhs2,kxx)

call bansol(kxp, thbw,ww,1,-(Kxp-1),wwtlnan))
do 20 j=2,Jx.-1
kKp=lekxpk(j-2)

call zmovewrd(xiol,wwllnan) ,kxx)
continue

fact=-,5/dt

fac2= ,5/dt

call zmovewrd(xioo,xlo,kxx)
call zmovewrd(xio,xtol,kxx]
call zmoveewrd(xroo,xro,Kxx)
call zmovewrd(xro,xrol,kKxx!)

time array
xrtime(n)=xrol(kplot)
if (mod(n,ndiag),eq,Olcall dltagno
ifitmod(n,nfourp).eq,O)call fourier
continue

ar ee

Cy.
Cys

’

i]

c
Cc

¢

call elsdsk(tocv,0}
call timeused(icp,jo,isy)
cpuoticpet im
cloFtto®timo
sysoztsytti

call ptcsher

call close(100)
call keep80(1,3)
call frBQid

call threed

call plote

call timend
call exitt(1)
end

subroutine constant

insert storage cliche here
use param
use fstor
use matrix
use const

gaml=,254(3tbiase¢])
gam2=,25%(1-bias)

tp=,5*(tx-2)

p=. 5e(fx-2)
kpletip-Teljp-2lalix-2)
kKp2=jJp-1+(jx-2)8(ip-2)
kplot=,58t(1¢tsw)tkp 1+, 58(1-isw)ltkp2
if(kplotm,ne ,OlkKplot=kplotm

return

end

subroutine curvecon

calculates constants necessary for curvature driven
flute mode case,

insert storage cliches here
use param
use const
real klbsq

Input for curvature driven flute case

data echarg/4,8e-10/, en0/1.00e+12/, bO/1.0e4/, amass/3, 34e-24/
, c@e/3,e10/, stable/.4/, fourpi/12,.56637/, pi/3,1415926/
, delrho/,O05/ ,dtrel/.02/,x«xm/3,.8317/, theta0/1,570796/

namelist/curve/bO , teta0,delrho,stable,end,echarg, lb,rw,xm
,zol,dtrel, thetad

call ddilecurve,2,3,1)

call ddolcurve,100,0,1)

zmax=zol¥®lb

pO=beta0ebOetee 5

psimax=rwkte2ebOe 5

omegO0sq=bO*e#2/(enOtamasst i bee2)

omegO=sart l(omeg0sq!

agl=1.-2,tdelrho/xme¥2

klbsq=0,

iff kzs.,ne,O)lklbsq=(pi/l2,*z01))**2

delomeg=0,
if(sfB,ne,O)
1 delomeg=stablet((beta0/xmeta-k lbsq/mmt¥2)/lagitsfB8lel,-sfbtagi/
2 sfBl*omegQsq
omegl=omegOtsart (delomeg)
wmeg2=omegl~-2¥sqrtidelomeg!)
dt=dtrel/omeg!
eni=2,k*enOtdelrho/rwt*2
ultx}szmax

vijxlspsimax
dutultx)/tixn-1,5)
dvevijxwl/7(jx-1,.5)
besarg=l(xm/rw!

Cisse, Calculate analytic growth rate

Cc.
Ga

Cc

ono anaonnnanan

oaanannnanan

-

tsfb=tan(thetads S)asf6
radical=((agl#mmetsf6)#*2%(omegl+omeg2!¥#2-4,%((omegl*tomeg2tagl
c ¥sfBtomegOsqtbetad0/xmet2) tmmee2-K il bsqtomegOsq) |) . .
if(radical.lt,Qlgo to §

root=saqrtlradical |
omanal=agl&tsfbtmm*lomeg)+ameg2)* Stroott,5
omana2=omanal-root

groana=0,

return

continue

omanalzagik*ttsfotmmklomegitomeg2)*,5

groanazsart(-radical)*,5

omana2=0,

return

end

subroutine tnputtm

roae CAlcuUlates grid quantities needed by sub, grid
cae Tn floratm version

wee Unsert storage cliches herr

use param
use const
real kibsq

.. glossary of Input parameters

psiOrel,,value of psi (lin relative units) where plasma pperp
profile is half the maximum, .
pewide,,parameter inversely proportional to “ramp width” of p2

psiOerel..,realitive value of psi where ering pperp (pe2) ts half

the maximum

peewide, parameter inversely proportional to “ramp width” of pe2

psitrel,.,lower limit of pst where pring =0.

psi2..upper timit of psi where pring=0,

zOrel..,axial center of plug

zirel,.axtal position of plug tnward mirror

zérel,.,axial postition of plug outboard mirror

z3rel.,inner axial position where pring=0.

z4rel..outter axial position where pring=0.

nslosh..peak sloshing ton number density

ncenter,.peak center cel! ton density

betsish...peak sloshing ion beta-perp w.or.t. bvac(z0)
betcent...peak center cell ion beta-perp w.r.t. bvac(z=0)
betsise...peak sloshing electron beta-perp w.r.t. bvaciz0)
betcene...pea center cell electron beta-perp w.ir.t. bvacitz=0)
betring,..peak electron ring beta perp wor.t. bvac(20)

oonoaoncnanantantnnanonana

tf)

ir]

+e @

ye be eit

aannqnananan

aon

onan

c

¢

rp...plug vacuum mirror ratio

ztrans,,,begining of center cell transition region
ltrans,,,.transition length

bmg...vacuum mirror peak (approx,! tn gauss
bceng,,,center cell bmax tn gauss

epsp,.,,minimum pressure, below which b=bvac
phicen,,.center cell potential relative to plug ton t perp
phiplg,,.plug potential relative to plug ton t perp
kKin,.,mumber of potnts | n sismsons rule quadratures
xpot.,.exponent coefficient in center cell potential
wpot,..exponent coefficient in plug potential
ypot,..power of polynomial tn potential psi dependence
pxpl..,power of polynomial ine ring pperpips!) (pllpsi))
pxpe.,,power of polynomial in e ring pperplips!) (plipsi))
zmax,.,axtal end of system in ecm,

ring pperp at psi=0,

input for tandem mirror equlib,

data echarg/4,8e-10/, enO0/1,.00e+12/, bO/1.e4/, amass/3, 34e-24/
, €@e/3,e10/, stable/.4/, fourpi/l2.56637/, pi/3,1415926/
xpot/1./,ypot/2,/,wpot/2./,kKin/S/psitrel/2,/,psi2rel/1.5/
ipsiOrel/.50/,zmax/100./,ztrel/.5/,z2rel/1,/,z0rel/,.75/
,23rel/,625/,z4rel/,875/ ztrans/,4/, |trans/,05/, pawide/.1/
.bmg/1,e4/, beeng/1.e3/, nsioshin/2.e13/, nceenter/1,e13/,
betsish/,25/, betcent/,10/, rp/4./, epsp/1.e-6/,rp1/2./
iphicen/,1/, phiplg/.1/, betcene/,1/, betslse/.1/

.dt/1.,e-5/, pfudge/0./, cold/1,e-3/, betring/0./,psi3relt/1.05/
ipxpl/2./, pxp2/2./, safe/.9/, pel0/0./,psiOerel/.5/,p2ewide/ .2/

namelist/curve/echarg, |b, rw,xm,rwl

,zmax,dt, theta0, pfudge

,psiOrel,zirel,z2rel,z0rel ,nsloshin,cold,z3rel,z4rel

incenter ,betsish,betcent,rp,ztrans,ltrans,bmg.rpl
.bceng.,epsp, phicen,phiplg, kin, xpot,ypot,wpot, betcene ,betsise
,betring,psilrel, psi2rel pawide,psi3rel ,.pxpl,pxp2,safe,pel0
,peewide, ,psidere!l

call ddilcurve,2,3,1)

call pfrome

cal! 6100

call ddolfcurve,100,0,1)

.transform input z into physical untts

zO=z0rel*zmax

zl=zirel*zmax

z2=z2rel*zmax

z3=z3re|l*¥zmax

z4=zdrel*zmax

ztran=ztrans*zmax

lItranz=ltrans*zmax

bm=bmg/saqrt(4,*pi}

bcen=beeng/saqrt(4.*pi)

generate zmax, psimax, ulix)l,vljx)l, du, dv

“asq=.25/((2, erp) eel2./3, 1-1, el 22-21) 442

argtl=¢(zl-ztran)/itran
bvO=bm*(1./(1.4(20-211882/asq) eet .541./11.¢(20-22) ##2/asq)
**1 5)
bmax=bmel(t.¢1./(1.¢lz1-z2)4*2/asqi*t¥41.5) +bcen. 58%
(1,-tanhlargt1))
bv4=bme(1,/11.¢021) 88 2/asq) #41,541,./(1.4¢(221442/asq) #41 .5)
psimax=rwtkokbmaxt 5
psiw=rwil**2*bmax* 5
psid=psimax*psidre |

210

psiQe=psimax*psiOere|
psi3=psimax*ps! 3re|
psitl=psimaxtpsiire|
psi2=psimax*psi2re |
vijxl=psimax
ultx)=zmax
duzultxl/lix-1,5)
dvevipuwl/(jx-1,5)

. transform input constants from relative to physical units

pmagQ=(bv0) «e256
pmagl=(bv4ebcen) #28 5
psloshin=(betsish) *pmagO
pcenter=(betcent)*pmag!
psloshen=bets|lsetpmagO
pcentee=betcenetpmag!
pring=betringtpmagd
phice=phicentpstoshin/(nsloshinkecharg!)
phipl=phiplatpsloshin/(nsloshintecharg!)

calculate maximum pll(psi)

epsidif=psi2-psil
pimax=(pxpl¥psidif/((pxpl+pxp2itpsitl)etpxplt(pxp2tpsidif/
c ((pxplepxp2)tpsi2l letpxp2

», check that kin ts not too big

ksimp=ksim

if( kin .gt.kKsimp! then

kKintksimp

write(59, 200)}kin

format('kin Initially too large, reduced to',14)
end if

», check that Kin is odd for simpsons quadratures

kch=mod(kin,2)

if (keh.ey,O) then

kKin=kin-1

write(59, 201) kin

formatl'kKin initially even, changed to',i4)

end if

, adjust epsp to accomodate zero pressure case
epsp=epspt(1.e-Atpsloshintepcenter)/(1.e-B*epsptpsloshintpcenter )

..check that been and betcen are physically consistent

asq=,25/((2,%rp)*al2./3,)-1,)#lze2-z1) 82

bvO=bme(t./( 1,41 20-21) *#2/asq) ¥¥1 541 ./(1.4(20-z22) #4#2/asq)
c*¥e1 5)

argt3=lz3-ztrani/itran
bv3=bmel(1,./(1.¢( 23-21) ¥*2/asq) ¥*1,.5¢41./(1.¢( 23-22) 442/asq)
c**1 S)ebcent,5#(1.-tanhlargt3))

rpx=bmax/(bv0)

rp3=bv3/bv0

afacelrpel(1.-1./rpee2) ) ek2/bmte2

afact=(rpt(1,-1,/rp3gee2) )ee2/bmee2
tconb=pring/((1.-1./rp 382) e422)

tminz=afactlbcentbv4) #x2

tfltmin. le. betcenttbetcene} then
beent=saqrtllibetcent+betcene!]/afaci-bv4

tmine=tmin-betcene

write(59,210)bcen!, tmine

format( initial central cell beta and b are inconsistent for’,
ec * equlibrium'’,/'either increase bcen to more than’ ,e14.6/
c ‘or decrease betcent to less than’ ,e14.6/'use namelist’,
c ' data format’)

namelist/better/betcent ,bcen

read(59, better!
pcenter=betcen! tpmagO
end if
C,..,. check plug ton beta and e ring beta
tminl=afactbvOxK2
if (tminl. le, (betslsh+betslse) )then
tbetsl=tmini-betslise
thetr=(-betsishetmint)
delbet=betsishebetsise-tminl
write(59, 220 idelbet ,tbets|!, tbhetr
namelist/fix/betsish,betslise
220) format('the sum of (betsish+betsise! is too large by’,
c @14,.6/'either decrease betsish to',et4,6/'or decrease
c betsltse to’ ,et4.6/'or something (use namelist data format)')
read(59, fix) .
psloshin=bets!sh*tpmag0
psloshen=bets!setpmagO
end if

Cisees Check betring in plug
If ltcon6,ge, (safe*t StbvO##12) | then
rattoz=safek StbvO*e82/tcon6b
pring=pring*ratio
ratinv=l,/ratio
write(59,231)ratinv, pring

231 format('pring was too large by a factor (',e14.6,'], and was',

c' reduced to ‘',e14,6 )

end if
C..... check that cot ts less than rpx

if(rpl.ge.rpx)ithen

rplterpl

rpl=,5%rpx

write(59, 230)}rpit.rpx rp)
230) format('’rpt (',e12,.6,') was larger than crpx (',e12,6,'1}], and was’,

c’ reduced to ‘,e12,.6 )

end (f

end

subroutine tmeon2
c..... Calculates equilibruim quantities for tandem mirror

C..4.. insert storage cliches here
use param
use const
real klibsq

c.....calculate heaveside step functions h1i2, hl, h3d4
call beast(h12(1),0.,1t«x)
call beast(h1(1),0.,ix)
call pbeast(h34(1),.0.,ix)
call beastthtrans(1),0.,1«)

do 2 t=1,Ix
ifl(zil.ge.zl.and.zéil.le.,z2ihielid=1,
if(zlidwle.zVhbtei deat.
iflz(i).ge.ztranihtrans(il=1.

2 iflz(il.ge.z3.and.zlil.le.z4)h3dlilel,

psim=psi0«(1.-p2wide!
psime=psi0e*(1.-p2ewide)

1+... calculate heaveside step functions hpOlj!], hp3lj} and hpl2tj)
call beast (hpt2(1).0,,jx)
call beastlhp3l(1),0.,jx)
call beast(hp0l(1),0,,jx)
call beastihpm(1),0,,jx)
call beastlhpme(1),0.,jx%)
do 4 j=1,jx

if(pst(j li te.psiQihpOlj )=1.
ifl(pstlj) le ,psi3dlhp3lj)d=t,
if(psilj). le.psimihpm(j lei,
if(psilj)l.le,psimelhpmel(j)=1.,

4 1flpsilj).ge.psil.and.psil(j).le.,psi2ihpleljy)=1,

ose calculate vacuum b field (bvac} and derivatives dbv/dz, d2bv/dz2

asqg=,25/( (2. erp leel2,/3.)-1, be (z2-z21) «82

bvO=bme (1,711.40 20-21)442/asq) eel S41. /(1.4¢(20-2214#2/asq)
c%e1,5)

do 5 t=21,ix

ebl=(zli)-z1)/asq

eb2=(zlil-z2)/asq

fbl=saqrt(1.¢ebtel(zlil-zt))
fo2=saqrtl1,+eb2e(2(1)-z2))

argt=e¢(zlti-ztran)/itran

dbvdz(t}=-38bmtlebi/fb1*e#5+¢eb2/fb2et5)-bceent,58#(1,-
c tanhlargt)##2)/l tran

d2bvdz2lil=-3tbmt(1./lasqtfb1es5)+1./lasqtfb2s45)-eb1##245/
cfb1 ek 7-eb2ee2eS/fb2t7 l+ebcenttanhlargt!#(1.-tanhlargt)#*2)/
c Itranut2
5 bvac(tlh=bmt( 1. /fbo1883e1 ./fb2843) +bcent®. 5#(1.-tanhlargt!)

argt3=(z3-ztrani/ltran
bv3=bme(1./(1.¢( 23-21) 8%82/asq) 4a1 541.711 ,.¢623-22) 8 82/asq)
ck*) S)ebcenk.5#(1.-tanhlargt3)}

rp3=bv3/(+¢bv0)

bmt=rpi*( bvO)

alsit=l((1.-t./rpree2i/(1.-5 Srp eto) ele pli/rpx) )a«e2
alstzalsit+¢.5#(1,-alsitl*prudge

bea calculate heaveside function h56(1) far second component of
.e+,e Stoshing pperp

do 10 i=l, ix

eb2=(zli)-z2)/asq

if(zlil.gt.zl.and.zlilvlt.,z2.and.bm1.ge.bvaclil)
c h56(i)=1,
10 continue
eee calculate pressure coeff. including electron ring cpr)

contl=l S(T. -1 ifr px 882) ah otbmax td)
con2=conl*®(-2kbmaxtt2)
con3=- .5¥con2tbmaxtt2
con4=pring/((1,-1./rpaes2) eu2tbv3aKd)
conS=con4t(-2kbv 3482)
con6=- .StconS%*bv34t2
dont=1./((1.-1./rplea2) an2abmi snd)
donZ=doni*(-24bmi*e2)
don3=- .5tdon2tbmitre

..eea Calculate constants for p3 pressure componetnt
data p30/.01/
we2=pewide*®.5%psid
woce=p2ewidet 5tpsile
woSs=awp2/psim

psiOr=psiO/psim

p3b=p30
psc=l,5#11,-(tanhl2.))¢*2)/ap3-p3btp2widetl2,-p2wide) |}
¢ *,5/pewide

p3d=-(p3bte2.tp3ckpsi0r)/(3.%psiOree2)
p3sa=-(p3btpsidOrep3ctps i Ora 2+p3depsiOres3)

¢....,calculate constants for pel

gep=- .54(1.-(tanh(-2.)) 882) /upee
g2f=,5%(1,-tanhl-2,))

ael=pel)

cel=psimertgep-g2fr+ael
bel=2,*«(g2f-ael)l-psimetg2p

Cr.e., readjust peak plug pressure for sloshing

rtemp=(bm1/bmax)**2

rpxl2=1,/rpx.*%2

terl=(rtemp-rpxi2) a2

ter2=(1.,-rpci2)ee2
bstr2=bmaxt¥2u(-teritalsitrtemptter2)/(-terlealsitter2)
pfloat=(l(conl-donttalsi | tbstr2uk2+(con2-daon2kalsi l#bstr2
c¢ +con3-don3talsi}*(1,+p3a)
pslosh=psloshin/pfloat
psloshe=psloshen/pf loat
nslosh=nsloshin/pfloat
psist=pslosh+epsloshe
pcenl=pcentertpcentee

do 6 i=#1,ix

eont=coni-donttalst*h56(1)
eon2=con2d-don2etalsi*th56/(i)
eon3=con3-don3talsi th56( i)

abf (t)=con4*h341i)
bof (it l=con5#h34(i}
ebfltl=con6#h34(i }
abplil=eonttlpslstthi2lilepcent#hi(i))
bbplil=eon2tlpsistahl2(ilepecent#hi (il)
cbhplil=eon3elpslst#thl2(ilepcent#thi(id)
abrlil=eont*lnsloshthi2lilencenterthi(i))
bor (i )=eon2t(nslosh#thl2(ilencenterthi(i})
cbrlilz=eon3*(nslosh#tht2lilencenterthili))
abqlil=eonl#lpsloshthi2lil+pceenterthi(i))
bbqlil=eon2k(psloshthti2(ilepcenterthi(t))
6 chqltl=eon3*(psloshthi2lil+epcenterthi(i))
return
end

subroutine equiltm
Coes equilibrium for tandem mirror electron ring plug

c....insert storage cliches here
use param
use const
use fstor

data epsb/1.e-2/, p30/.01/
c..... loop 10, calculate p2 pl and b and dp2/dpsi and dpl/dpsi
wp2=pewidet.5tpsid

c

psibar=-bel*® 5/cel
pimax=del¢beltpsibdrtceltpsibar te?

do 10 j=l,jx

psir=psiljs)/psim

psire=psilj)/psime
pel=(aeltbeltpsiretceltpsiret#2) thome(j )
pe2=.58(1.-tanhi(psilj)-psi0e!l/wo2e) 1*11.-hpmelj)}
plljl=(peltpe2)/pimax

dplidpsil(jl=(bele2.tceltpsire)/(psimetpimax) thpmel(j)-,5¥(1,-

((psilj)-pstOel/wp2e) 142) /lup2etpimax)*(1.-hpmelj))
petijlelt.-tanhi(psilj)-psi0)/wp2))*,5
dpedpst(j)=-.58*(1.-(tanhl(psilj)-psi0)/wp2) )#*2)/up2
p3ljl=(p3arp3bansirep3ctpsir xe2ep3dtpsir ee 3) #hpO( 5)
dp3dpsiljl=(p3be2. tp3ckpsir +3. tp3dtpsir t42) #hpOl jy )/psitm
peljl=pet(jle+p3lj)
dp2dpsi(j )=dp2dpst(ji+dp3dpsi(j)

tF Ei pelgdd, it epsplgo to 50
do 171 1=1,1

iflabplil. 0g. O)then

bli, jJlebvac(t)

go to 1

end if

ul=p2lj)*abplilept(j )*abfli)
u2=p2lj)ebbplile Sept jy) sbbf li)
ti=-u2k.5/ul
us=pelj)ecbplil-bvac(i)##26 Septljlecbflil
radic=saqrt(tl##2-u3/ul)
bsql=ti¢radic

bsq2=tl-radic

bsq=bsql
ifltl.gt.radiclbsq=bsq2

bli, jl=saqrt(bsq)

continue

go to 10

b=bvac if p2,lt.epsp

do 51 t=!,ix

bli, jlebvac(i)

continue

., loop 15, calculate phi, the electric potential

do 15 t=1,ix

argl=({zlil-zt)/t21-20) )ee2e(-xpotied1.-hi tid)
arg2=wpot*((z(i)-z0)/(20-z2) }*82
phillil=phicetexplargl)+phiplt/coshlarga)

do 16 j=e2,jx

phi2lple(1.-Cesilj lthp3ty)/pst3ietypot lehp3lj )
cont lnue

loop 20,calculate pperp, ppar and db/dpsi

petal. /(1.-1./rpise2)ene
dtert=(-8./3-4.#lbmax/bml)#43/3.+4, 4 (bmax/bmt!)/bm!
dter2=-alsit¥ppttdterl*psisl

do 20 i=1l,ix

do 20 j=1,jx

b2=bl(i,j)**x2

b4=bore2

dter3=dter2*h56(i)
dter=(4,¥*abp( i) *bmaxt#2/3,¢2,.%bbplil)tbmax+dter3
ppart=(-abpli)/3."%b4-bbplileb2+cbhplil+dtertb(i,j))
ppert=labpli)tbdé+bbplil*tb2+cbpli))

(tanh

pperte=l(abaqli)tb4ebbal i) *b2ecbhali))
pperpli,jl=p2lj)*ppert

pparli,jl=p2(j)tppart

aubl(it,jl= (b2¢pparli,jl-pperpli,jli/bli,js)
rholit,j)=samasst(p2(j le Stlabrl i )sbdebbre (i) ab2ecbr li) )+
c p2lj)*ee Sancentertcold)

fac=ebli flall ¢2.epl(j dele. sabi t)ab2ebbf(i)))
facl=dpldpsi(jielabfliltbaéebbfliltb2ecbf lit)
fac2=dp2dpsilj)*labpliltb4+bbp(i)tb2+cbp('))
fac3=p2l(jlael2.sabpliltb2ebbplillep t(j )el2.eabfl i leb2ebbfl(i))
dodpsili,jl=-(factefac2)/lbli,pialt.¢fac3«2,))
dp2db=bli,jlel(abplilsb2e2.+¢bbpli))e2,
dp2dbesbli,j)*labqlit)*b2*2,+¢bbqiit))*2,
dp3db=dp2db-4,. #abpliltbl i,j )¥83/3.-2.8bbplilebli,j)
c ¢dter
qubv(i,jl=(-dp2dpsilj)*(ppert+ppart)-p2ljitdp3dbedbdpsilt, J!)
pharg=psi(j)#hp3(j)
dphidpsizphilliistypottlpharg/psi3)#elypet-1,)/
c (-psi3lthp3lj)

epsi(t,jl=-dphidpsi
dpdpsi=ppertetdpedpsi(j)+p2lj)tdp2dbetdbdpsi(i,J)
omegclizechargtbit,j)l/lamasstcee)

omegstr=-blit,j )*dpdpsi/omegc!

omaeggb=ppertetp2(j )tdbdpsili,J)/omegcei
omegexb=-rhol!,jl*ceetdphidpsi#t 65

xxx (i,j l=loneggb-omegstre2, tomegexbi%4sfé
yyyli,j)=lomegexbtomeggb)*lomegexb-omegstr) *sf8
ppertrs=labf(iltbdebbf() leb2ecbhf (i) )
peerpsli,jlepperpli,jleptljleppertr
pperpeli,jl=pllj)*ppertr

20 continue

C......check for negative pressure, and terminate prob. if necessary

do 25 j=i,jx
do 25 i=1,ix
iflpperplt,j).lt.O.or.pperpeli,j).lt.Q.) then
write(59,101)

101 format l'problem terminated due to negative pressure’ |)
call exit(l}
end if

25 co..tinue

c....calculate diagnostic on perpendicular pressure balance
do 80 t=1,ix
do 80 jzi,j~
errprpli,jle(bli,j)ee2-bvacti les2¢2 apperps(i,jll/bvac(i}s«2
B80 continue
c..,.calculate diagnostic on parallel pressure balance
do 81 jz2,jJx
do B81 i=2,ix-l
delb=bliel, ji-bli-1,j)
iffabsldelb) .lt.epsbithen
abar=-abp(il*5./3.
bbar=-3.8%bbpli)
dter3=dter2#h56/i)
dter4=(4.tabpli) *bmaxt#2/3.¢2.tbbpl il) *bmax+dter3
dbar=dter4At2,
factor=-(aébartbli.j )etA+bbartbli, JIte2ecbpliledbartbl(i,j))
else
factor=(pparliel, jleblie¢t,jl-pparli-t,j)*bli-1,j))

81

30
31

¢

aoe

c

fdolb
end if

errprili-l,j-ll=(pperpli.jl-2

cal. r and r2z2%r
do 40 te#i,tx
sumi=0,
sume=0
sum3=0.
sum4=0,
sum5=0,

do AQ j=2,
dps=dpsi(j
pstb=psilj-1)

if(j.eq.2)then

J*
}

dps=psil2)
psib=0,
end (f

iflt.gt.2lgo to 31

call beast (hpkO(1},0. kin}
call beast l(hpk12(11,0. kin)
call beastlhpkm(1!,0.,kin)
call beastlhpkme(1},.0, hin!
do 29 k=1,kin
psik=psibtédpse(k-T)/ikin-1)
ifl(psik. lt. psiO lhpkO(kI=1,
if(psik. It.psimlhpkm(k)=1.
iflosik. tt.psimelhpkme(k)=1.

§pparli,ple¢factor)/bvac( i )##2e2

iflpstk.lt.psi2.and.psik.gt.psillhpki2t(k)=1.

continue

cal. pl (pik) at intermediate points tn dpsi interval

do 30 k=1,kin

psik= psibedpsa(k-1)/(kin- 1)

psikr=psik/psim
psikre=psik/psime

plek=l(aeit+tbel*tpsikre+celtpsikret*2) thpkme(k!
peek=,5*(1,.-tanh((psik-pside)/we2e) 1*(1,-hpkme(k!}

pik(k,jl=(plektpzek )/pimax

p3k=(p3atp3btpsikr+p3ctpsikr xe 2+p3dipsi kr ¥*3) thpkOl(k!
p2k(k , jl=(t.-tanhl (psik-psi0)/wp2)})*.5 +p3k

continue
continue

do 32 k=i,kin

if((p2k(k,7}).le.epsp.or.abpli}.eq.0} then

bk=bvac(i)
else

ul=p2k(k,j)¥abplil+ptkik,j)eabfli)
uZ=p2k(k ,jl¥bbplil+pik(k,j )*bbflid+.5

tie-u2* .5/ul

ussp2kl(k , jl¥cbplil+ptk(k,ji*tebflil-bvacli})**2* 5

radic=saqrtit?**2-u3/ul)
bsqt=titradic
bsq2=til-radic

bsq=bsq!l

if(tl.gt.radiclbsq=bsq2
bk=saqrt(psq)
end if

capf=l. +42. eptk(k J i*(2. kabf (i) Kok eee+bbF (i) 142, ep 2k (kj )*

(2.*abplil*bk**2+bbp(i})
delil(k)=1./bk

delt2(kl=l,/lbke43kcapf }
delid(k)sdeliQ(kl lc apf AbK KK. |
delid4(kl=epikik, J l/(capfxbk | **3
deltS(klep2kik, J lflcapfkbk ) x3
32 continue
cdll simpsideliit,dcapit, kin, dps!
call stmpsldeli2,dcapi2,kin dps!

call simps(deli3,dcapi3,kin,dps)
¢ call simps(delt4,dcapt4 kin dps)
call simpsideli5,deapi5,kin,dps!}
capt t=dcap!1+sumt
caple=dcapli2+sum2
capl3=dceapi3+suma
capldzdcapiA+sumd
cap Ssdcapi5+sum5
r(t,J)esaqrtl2, capil)
vv lslbvac( tl &dbvdz({t))#x2
vveebvaci( | )#d2bvdz2lit)+dbvdz(i)}**2
rzz(t,Jleevvlkcaplawk2/r (tJ ee3+3 vv ecapl3/r (tif)
gc ~vvekcaple/r li, Jl+B. ebvacl( |) ee 2K labfli)tcapldtabp(i)s
¢ captS)l/r(t,j)
suml=+capi1
sumezcapla
sumdscapts3
sum4=capi4
. sum5=capi5
40 continue
Crier 8@t (i ,dberlt,2)
do 41 t=1,1tx
4) r(t,dbsre(t,2)

¢ calculate diagnosite quantities flutel, flute2 and flute3
do 60 jzea,Jx~l
Isz2

if (mod(tx-2,2),eq,0)is=3
do 61 teIts,tx-1
fazi-is¢]

eterm=dpd2dpsi(j)*labp(i)*bl(t,jletdtbbp lt) ¥blt,j)ee2ecbpl(i))
ec +pelj)e(Atabpl( id eb( tJ) ee 3+ 2k bbpl i debl i, jl) #dbdpsili,j)
ringj=dpldpsi(j)elabfl(ileb(t, J )ee4ebb (i leb lt, jletaecbf lid)
c spi lj )#(A#abe (1) 8b (1, | )#HSsDebbE IT )EB(1,}) )#dbdpst (i)
dflutel(ial=trazli,j)¥qubyl i piZle (i, pl ebld, J pee!) ZuuZ( 1)

c teterm¥*ringj/bl i,j U**3/uuzlt)
dflute2(tal=yyyli pil (r (i, J bebtt. js)

c )¥*2ebl 1, J) )Zuuzl i)

dflute3(talerhol(t jlZlle(t,j) kbd jd) ee2ab (ty pli /uuz(t
dfluted(ia al=xxx(t,J)/| (edt, gp) tor pl beeeeb (i, pd) fuuztt

61 continue
call simps(dflutel,ans1,ia,du)
call sitmps(dflute2,ans2,ia,dul
call stmpos(dflute3,ans3, ia,du)
call simps(dflute4,ans4,1a,du)
flutel(j)zansielta-1)
flute2(j)=lans2e(mmet2-1)+¢anst)*¥(ta-1)
flute3(j)=-ansl/ans3
rhoavealj)=ans3¥(ia-1)
xxxave(j)=ansda(ia-1|
yyyavelj)=ansetlia-1)

60 continue

c,.... local growth rate for high mm, (wkb approx, }

PAGE

do 70 ;32,Jx-1
omegwhb=mm&, O¥uxxavelj))/rhoavel j )

trad=,25¥mmeean(xxxavel() )#*2+4,trhoavelj) ltyyyaveljs))

¢ =rhoavel(j)¥*2rflute3i(j)

ifltrad,le,O,)then
gamwkb(jl=sqrt(-trad)/rhoave(j)
omegtwkb(j | =omegwkb
omegewkb(j)=0,

rho=const.,

else
omegiwkb(j )=omegwkb ¢sqrt(trad)/rhoavel})
omegewkb(j l=omegwkb-saqrtltrad)/rhoave(})
end if
70 continue
return
end
subroutine simpsifin, fout, knn df)
Cy,.s.stmpsons rule quadratures, knn must be odd
dimension fini(1)
nse=l(knn-1)/2
sez=ssuminse, fin(2) 2)
nso=nse~|
so=ssum(nso,fin(3},2)
foutzdf/(3, el hnn-TIel fini llefiniknan) +4, ¥se+2, ¥s0)
return
end
subroutine equilcur
c..,,equilibrium for curvature driven flute mode case,
c....insert storage cliches here,
use param
use const
use fstor
do 10 t=, tx
do 10 j=l,jx
Cu, , special bli,j) to test b.c. on flute test case
bl(i,j)=sbO
r(t Jlesaqrtl2atpsil(j)/bli, jd)
rholt,jlelenO-ent¥r (i,j )*t2e,5) *amass
xxx, plerholt,j)*lomegi+tomeg2)¥sf6
yyylt,jlerholt,j1*l-omegi*omeg2) 4*sf8
qubl(i,jlebli,j)
qvlt,j)=pO/psi(jx)
10 continue
return
end
subroutine equi |
C.eees Spectal case equilibrium, O beta, O pressure,
Cisees test case |
c.....set up 1/4/82 by r, freis
c. .tnsert cliche storage here

us" param
use matrix
use const
use fstor

data rho0/1.e12/,b0/1,e4/,azm/1./,apsim/1./

PAGE

ca)

30

a oe © 6 ee
CD

eo @ et

>

t(2.#absipsi(j})/b0)

-

nnua Ow — tl

Too
oO-

return
end
subroutine equilrot

sets up equilibrium for rigid rotor, test case 2 ,

..flora3 adds cold plasma halo to equilbruim density

insert cliche storage here
use param
use const
use fstor

ps !O0=bO%r0sqt .5/sartifourpi |
omegr=ratrod*tomegst*(1,-enbar/enO)
foursq=saqrtifourpi )

do 5 j=1,tx
uzzuuz(t)
do 5 j=l,jx.

faczexplpsi(j)/psi0)/sart (beta0)
bii,jl=bO*saqrt(fack#2-1.)/( factfoursaq!)
rholt,jleenO*amass/(betadsfact#2) +enbartamass
beta=1/fac%*2
argl=factsart(fack#2-1,}
acosh=alog(argl)
rlt,p)berO*esart(-ertacosh)
qubli,jl=bli,j)
omegstr=omegst*(1.-enbartamass/rholi,j))
entest=enbartamass
iflentest.ge.rhol(t,j)lomegstr=0.
omegexb=(1,¢ratrod)*omegstr
omeggb=+betatomegstr*.5/(1,-beta)
xxxli,plerholt,j)#(2. tomegexbtomeggb-omegst )
yyyli,J)leerholt,j )*lomegexbhtomeggb!] *lomegexb-omegst !
weed, plexxx (i plefile
yyvlt.jleyyyli plete
continue
do 30 i=1,i«
do 30 jF2,jx-]
qavli,jl=.5elqubli,jelleblt,j+t)-qub(it,j-1)bebli,j-1))
continue
return
end
subroutine initial

set up initial displacement vectors, xro and xto
test case 1. cos(kz) in z, flat in psi
set up 1/4/82 by r. freis

insert cliche storage here

PAGE 4

use param
use fstor
use matrix
use const

data pi/3,1415926/

rof=1.
do 10 jH2,jx.-1
rl=ranf (lb
r2=ranf(b
r3-=ranf (l(b
r4=ranf (b
do 10 t=2
if(kKzs.eq
rbf=1./lr
else
ril=ranf (bt)
ré=ranf(b1)
r3=ranf(b1)
r4=ranf(b1)
endif
5 continue
kK1=t-leljr-2)alix-2)
kK2=j-le(ju-2)e(5-2)
k= Sul ieiswltkt+ Se(1-tsw) tke

-
then
j)leblt,jd)

/j*
1)
1)
1)
1)
, ix
,O)
(ji

t

xrol(k)=exOerbfel(rler2-1, leexltcos(  Stpit(z(i)l/zedgel
xiol(klsexO8rbfel(rBer4-1, beexttcos( Stpitzli)/zedge)
c xtolkl=cos(theta0l*xrolk)

10 continue
do 20 j=2,jx-1
rl=ranf(b1)
r2=ranf (bl)
r3e=ranf(b1)
r4=ranf (b1)
do 20 j#2,ix-1
if(kzs.eq.0)}then
rbf=1./(r(i,plebli,g))
else
ri=ranflb1)
rée=ranflbl)
r3=ranf (bl)
r4=ranf lb)
endif

15 cortinue

kKtsi-le(p-2)e(ix-2)
kK2=f-1e(ju-2)e1-2)
k=, 54 (1eiswltk1¢,.58(1-tiswltk2

xrool(k)=exO0¥rbftlerTer2-1,)+exltcos( ,Sepiel(zli))/zedge)
xioolk }=exO8rbfelr3er 4-1, )eaxttcos( Stpitz(t)/zedge)
c xtoolk)ecos(theta0)*xroolk)
20 continue
return
end

subroutine input
Coeaee insert storage cliches here
use param
use const
use fstor

PAGE

- » -_ «+ .

annananna

rr a ae
rr ary

¢
Cc

10

15

boundary conditions are set as follows:

at z=z0 (t=1), fitl=-1, tmplies «=0.
fil=1. implies slope=0,
at z=zmax (j=tx), fizx=-1. implies «=0
fizx=1. implies slope=0.

at psi=psi0 (jt), fyiz-1. implies x=0,
fjl=1., implies sltope=0.,
at psi=zmax (jeje), fjrxn=e-1. implies x=0,
fjrx=l. implies slope=0,
data mm/4/, bias/,5/ Imax/2/, nmax/5/,dv/1./, du/1./
mdiag/lI00/, FITS, Fizx/1 J. FSV. Fpee/1 if, fle

6sf6/71.7, sfB/1,/7, kplotm/0/, kzs/t/. swg1/1./, swg2/1,/

, swgad/t./, swg4/1,/

forced data loaded for testing fourier analyses and zed file

maker

data jfour/1/,nfourp/1/,nfourmax/5/

namelist/nowl/aname,mm, bias, Imax, nmax,ndiag
FTL ftzx FUT. fjrx,exO,exl,fpsi,fu.fv,fz

LKplotm,kzs,j four nfourp,nfourmax,sf6,sf8,swgl,swg92,swg3,swg4

call ddilnow!,2,3,1)
call ddolnow!,100,0,1)
Jxetjrx

kxx=kxp

Ix =l2x

return

end

subroutine grid

relates physical grid z,psi to computational grid u,v
spaced |, uses input fpsi, fv, fz, fu and azm, apsim

insert cliche storage here

use param

use const

xvealoglfpsi)/alogifv)
xu=aloglfz)/aloglful
zzp=0,

psip=0,

do 5 t=1,ix
ult)suO¢dut(i-1.5)

ult )=-ult)
azm=ultx)d eel 1 .-xu)

do 10 t=1,ix
uuzlilsult eet). -xul/(xutazm)
zlib=azmsul i) ®#xu

uuzhltlel(ulil¢, Stdulea(1.-xul/(xutazm)
dz(tl=zlitl-zzp
zzpzz(i)

continue

zedge=azm* Stlulixletxuculix-T)atxu)
do 15 j=1,Jx

vijplevOe(j-1.5)4dv

continue

vitle-vll)

lequally

PAGE 6

apsimeviju)aee(di-xv)
do 20 j=l,jx
vpst(jlevigiee(t.-xv)/lapsimaxy
vpsth(jlelvigde¢ Stdylaall,-xv)l/lapsimexy)
psi(jl=apsimtvtj )eexy
dpsil(jl=psilj)-psip
psipzpsi(j)
20 continue
Cosy... Calculates v at plasma edge
vw=(pstw/apsim)*e(1./xv)
dvinzelvw-vijx-1))/dv
dvouts(vljxl-vwl/dv
return
end
subroutine fltol]
1iee CAalculates the fl to FIT functions needed to generate the a and

Crue
Crees, b matrices . uses the equiibrium quantities r, rho, b, etc,
Cun, insert cliche storage here
use param
use fstor
use matrix
use const
mo=mmekO
du2=duk*k2
do 10 t=1,1tx
do 10 jz=2,jx
r2er(i,j) "#2
uz=uuz(t}
bb=bli,j)
vp=vpsi(j)
rd=r2ene
Flt, plecholi,j)*¥bbard
f2t=(T.-m2)trholi,jl/bber2tvpel(rholi,jell-rholi,j-1))7(2,4dv)
f2li,j)=f2t/vp
F30T, Jdemmexxxl i,j ler aebb
FALE Glee -m2) ammexxxl i,j) /bb
F5Ci, ple-metyyyli,j)eraebb
F7(CT JdECT -m2) el -m2ityyyli, jl / (i bbevp)
g4li,jlequbli,j)er(i,j)*e*2
gsli,jler li, jlebli,j)
g2li,jlequbli, jif(r (i, jdebli jp) ieee
dppdpsi=dp2dpsilj)*labplil*bli,j)**Aebbpl(ileb(i,jiee2+cbpli))
c +p2(j)¥l4tabpl(iltb( i,j )ee3e2tbbp li )tbli,j))*dbdpsil i,j)
dpedpsi=dptdpsi(j)elabfltlabli,j)eedebbF l(t )eblt,j)ea2ecbFltl)
c +plljielAvabf (i) tbl, jp) eese2ebbe (i deb Ci, jl ledbdpsif( i,j)
gilt, pleel(mm*tuuzl i) lee2er (i plalrezzli,s)
ctquby(1, j !tdppdpsitdpedps ite (i, 51 /b(1, 511
gilt, pl=gl(t, 7 )*swal
g2li,jl=g2li,j )*swg2
g3lt.jl=g3lt iJ }*swg3
gAli,jl=g4li,j)*swad4
Coesae special gi to test bic. on flute test case
c glli,jle- immXuuzt i) ee 2ae (1, Jlacli,pil7ibese2
c e¥qvli,j)
10 continue

c..... fill in edge values

eo

f-

—

| i Bn Oe a Oe
QO ~imn Bo AD -*-
ae ae ee
fho- f-
M—M—h— fu

HoH Ww tf WoW eR

20 contin

subroutine amat

.eeee Calculates the matrix coefficients for al, a2, a3, b1, b2
reves TM the equation alex(nel)=a2¥xl(n)+adaxl(n-Tlebtayl(nitberyln-1) ,
.eaee US@S Fl to F111 from subroutine fltoll and equilibrium quantities,

Dee cliche storage here

use param
use fstor
use matrix
use const

data unit/1./

gam3=-gam2

du2=duts2

dt2=dtt#o

dv2=dvta2

dvt=2,tdv

mo=mmeee

Jxejrx

Teeizx

do 10 t=2,ix-1

do 10 j#2,jx«-1
kKi=i-le(j-2)elix-2)
kK2ej-Teljpx-2)ali-2)

k=. 5e(1eiswltki¢ 5Sell-tswltk2
ré=rli,j)**2

vpz=vpsi(j)
uzzuuzli}
bijmh=(bli plebli,j-1))*,5
bijph=(bli,jlebli,jet))a.5
bipljph=a(bliel,jetlebliet,j))#.5
biplimh=(bliel, j-llebliel,gida.5
bimisphe(bli-1,jetlhebls-1,j))*.5

bimijmh=(bli-? J-Tiebli-1,jp))#.5

gA4iphjph=(g4liel jetllegAli,flegAliet, pleg4li, pet) )*. 25euuzhli)
gh4iphjmh=(gd4lie+t, jr-lil+gAli flegd4liet, plegdtt,j-1)) 8, 25euuzhlil
g4imhjph=(g4li-l jelleg4li, flegAli-l pleg4li,jetd le. 25euuzh(i)
ghimhjmh=(g4li-1,jr-VlegAli,jlegAli-1,jplegd4li,jf-1))8,258uuzh(i)
gZiphjelg2liel jleg2li, flies. Stuuzhli)
g2imhj=l(g2ti-1,jleg2li,jd)*.Seuuzh(i-t)

gsiphj=l(g3liel jleg3li,jlle.Seuuzhli)
g3imhjelg3li-t pleg3lt, pide S#uuzhli-1)

fFlijph=(FT(i plef Ci, jellie Stvpsiht])

PAGE

60

c mm*¥k2eb (1,

Flifmh=(fF T(t pleft tt, j-T))e* Savpsth(j-1)
FSijph=(F5 (i plef Sli fet dle Skvpsith(j)
FHigmh=(FS(i Fler Sli, f-11)* Sevpsih(j-1)
if(j.gt.2lgo to 60

flijmh=0,

fEijmh=0.

continue
uzbar=-uuzlilerdt,j)/(du2tdv2)
alik ll=-gamitbimijmhtgdimhjmhebijmh*tuzbartvpsthij-1)

ec &r(t-1,j-1)

a2tk 1) =-gam2ebimijmhtg4imhjmhtbijmhtuzbartvpsih(j-t)

e er lti-t,j-1)

a3(k, 1) =-gam3ebimtijmh*gdimhjmhtbi jmhtuzbartvpsih(j-1)

¢ rlt-1,j-1)

Al(k 2)=-Flifmh/( (dttdv) 82} egamix( FSi tmh/dv2+bt jmhtsx2kuzbar
c Fvpsih(j-1T)er (i, jr) elgdimhjmh+g4iphjmh) |
a2lk ,2)=-FIT mh (dt tdv) 82) egam2e( FSi jmh/dv2+bi jmhee2¢ucbar
c kvpsthtj-tlte (i, j- Tiel gdimhimheg4iphjmh) )
a3tk, 2)2-FLijmh/ ( (dt¥dv) 882) ¢gam3e( FSi jmh/dv2¢bi jmhek2*uzbar
c tvpsth(j-Vae (i, j-Tbtlg4imhjymhtgdiphj mb) |

al(k,3)=-gamitbipljmhtg4iphjimh*bi jmb*uzbartvpsihl j-1)er lied,
a2(k,3)=-gametbiptjmhegd4iphjmhtbi jmh*uzbartvpsih(j-tler (ied,
A3(k , 3)=-gamatbipljmhtg4iphimhtbijmhtuzbartvpsihij-tler(iel,
al(k Alegamiel(bimljmhtgd4imhjmhtvpsth(j-litbipmhebimljph*g4imhjph
c 8vpsthlj)*bijph) *uzbartc(t-1, plemmee2eb( tj ltuzbart
c¢ gZimhj4g3li-1,j)8dv2/vpsilj))

aZz(k 4)=gam2e((bimlimhtgdimhimhtvpsih(j-Tlebijmh+ebimliphtgdimhjph
c *vpsith(j labijph) *uzbartrli-t,jlemmee2eb( i,j )tuzbars
c g2imhj¥*g3li-1,j)*dv2/vpsi(j))

a3(k Al=gam3t((bimlimhtg4imhjmhtvpsihl(j-1ltbijmbhebiml jpheg4imhj ph
c ¥vpsith()} )*btjph)®tugbarer(i-1,j )emmet2ab( i,j) euzbart
c g2imhj*¥g3li-1,j)#dv2/vpsilj))

al(h SIHC(FLijpheflijmh)/dv2-f2 (i, jl) /dt2+gamial-(fS5ijph+fStymh
V/dv2ef7(i,Jlegtli,plel-bijmhea2ul(gdimhjmh+gdiphjmh) tvpsith(j-1)

c ~bijph*s2n(gdimhjph+g4iphjph)tvpsih(j) lari

c mmee2tb (i,j btuzbar tl g2imhj+g2iphj )¥g3lt, jladv2/vpsi lj!)

a2l(k SI=((f1Tifpheflijmh)/dv2-f2(i,j))/dt2+gam2e(-(f5i jy ph+f Si jimh
VJdv2efF7(i plegl li, plel-bijfmhes28 (gdimhjmh+gdiphimh) *vpsih(j-1)

c -bijph*s2el(gdimhjph+gdiphjph)*vpsthl(j )larci

c mmtt2eb (i,j )tuzbar ti g2imhj +g2iphj )4g3(t, jl edv2/vpsilj))

a3tk, Sl=((Flijpheflijmhl/dv2- f2li, p11 /dt2¢gam3%l-( Si jphefSijmh
\/dv2ef7ti, Jleglli, j)4l-bijmh¥e2% (gdimhjmhegdiphjmh) ¥vpsihlj-1)

c -bijph*x2«(gdimhjphegdiphjphiavpsih(j))#r li,

j)*uzbartlg2imhj+eg2iphj )4g3li,jiedve/vpsil(j))

_j)*®uzbar-

_j )*uzbar-

j )*uzbar-

al(k 6Gl=gamIs((bipljmhegdiphjmhtbi jmhtvpsih(j-t)l+bipljph*gd4iphijph
c Kbhijph*vpsith(j))*uzbarer(iel, jlemmee2eb(i,j )*uzbars
c g2iphj%g3lie¢l jledve/vpsilj))

a2(k Bl=egam2t((bipljmhtgdiphjmh*ebijmhtvpsihl(j-ll+ebiptjph*gdiphjph
c ¥bijph*vpsih(j))tuzbaree (ied, j )ommee2eb( i,j) *uzbars
¢ g2iphj¥g3liel, jl tdve/vpsil(j)) .

a3(k G)=gam3t((bipljmhtgdiphjmhtbijmhtvpsih(j-1l)l+bipljph*g4iphjph
c *bijph¥vpsth(j) )*uzbac ter (iel, j bemmee2ub (ij) *uzbart
c gZiphj*g3lie¢1, jledve/vpsilj))

PAGE 9

al(k,7l=egamixi-bimljph*tgdimhjph*bijphtvpsihi(j )*uzbartr(i-1, jet) )
acdi(k ,7l=gam2i(-bimijphtg4imhjphebijphtvpsihlj )*uzbarerli-1, jet)
a3ik , 7l=gam3el(-bimljphtgd4imhjph*bijphtvpsih(j )*uzbarar(i-t, pet) )
al(k Bl=-flijph/(dt2tdv2)+gamie( FSi jph/dv2+(bijphee2el(gdimhjph
c tgdiphiphl¥vpsihij l¥e(i, jel) kuzbar))
a2(k Bl=-FITj ph l(dt2tdv2l+gam2el FSi jph/dv2e(bijphe«2elgdimhj ph
c +g4iphjph)*vpsithi(j leet, jel) *uzbar) |
asik Bl=-FITjJph/(dt2edv2legam3ae(f5t jph/dv2+(bijphee2e(gs4imhjph
c +g4iphiph)evpsih(j dar (i, j+1)®uzbar) |)
al(k Dlegamie(-bipljiphtgdiphjph*bijph*tvesth(j)*uzbartr lie, jet) )
a2(k ,I)=gam2e(-bipljphtgdiphjph*bijphtvpsih(j )*uzbarsr (i+1,j41))
a3(k ,Fl=gam3tl-bipljph*g4iphjphtbijphtvpsth(j )*uzbarterliet, jot) )
c.,...b61 array for rhs
F3ijmh=(F 30 plef ali, f-1))e Stvpstht(j-1)
fF3ijph=(F3CT, plef3ali, jel) d* Sevpsihlj)
denom=1,/(dv2)
biik ,T)=f3tjmhtdenom
bik, SI=f3i; phtdenom
bI(k, 2)e-(F3tpmheF3ijph-FAlI, jl &dv2/vp) tdenom
10 continue
c...,.correct coefficients on boundaries
sfil=signt(umit,fi1)
sfjl=signiunit,fj1)
sfjrx=signiunit,fjrx)
sfizx=signiunit,fizx)
C..4.. S@Ot corners to 0
Kitsix-2
K1jpetelix-3)eljx-2)
K1=.54(eiswlthli+ Sal t-iswltk1j
facl=-1,
ifisfplleq.land.sfizx.eq.lifact=erl(ix-1,2} #blix-1,21/
c (rlix,2)#blix,2))
ai(k1 Sleatt(kt Siefact#at(k1,3)
a2(k1,5)=a2(ki Sl+fact*¥a2(k1,3)
a3(kK1,5)=a3(k1 , Siefact*a3(k1, 3)
at(k1,3)=0.,
a2(k1,3)=0.
a3(k1,3)=0,
K2tste(ix-2)8(jx-3)
kK2jsjx-2
K2= 5e(1eiswltkh2t¢ Sel l-iswlek2]
fac3=-dvout/dvin
ifisfjrx.eq.l.and.sfil.eq.tMifac3=r(2,jx-1l#bl2,jx-1)/
ec (r (4, jw-Tbeb(1,jx-1))
al{(k2 S)zatt(k2, S)efac3talt(k2,7)
a2(k2 Slza2i(ke Siefac3ta2(k2,7)
a3(kK2, Slzad(k2 S)efac3tasl(k2, 7)
al(k2,7)=0,
a2(k2,7)=0.
a3(k2,7)=0.,
fac2=-1,

if(sfjl.eq.l.and.sfil.eq. ac2erl2,2)*b(2,2)/lr(1,2)4b1(1,2))

Tf
a1(1,5)2a1(1,5)¢fac2uat(1,1)
a2(1, 5)za2lt,5)¢fac2ta2(1,1)
a3(1,5)=a3lt, 5)+fac2eagi1.1)
ai(1,1)=0.
a2(1,1)=0.,
a3(1,1)=0.

facd=-dvout/dvin
if(sfjrx.eq.l.and.sfizx,eq. 1) facd=rlix-1,jx-T)tblix-1,jx-1)/

el
uj—

12

21

22

(rl tw, pu-Dbeblix,gxe-1))
at( Hbzal(kup, Slefachtall(kxp, 9)
a2ikxp ,S)za2(kxp Slefacdta2ikxp, 9)
a3ikxp Sl=zasikxp Slefacdtazg(kxp,9)
atikxp,9)=0,
aZi(kxp,9)=0.
a3(kxp,9)=0,

=2
do 11 j=2,jx-1

iflsfilieq. Vi isfiler(2,j)ebl2,p)/(r(1,jpleblit gt)
kK1ei-te(jr2)elix-2)
R2=j-Veljx-2)8(4-2)

=, 50 (Veiswhtkh1¢ 58(t-isw) tke
do 11 m=2,8,3

al(k, mizaltk, mle+sfitleat(k,m-1)
aZik ml=a2l(k miesfilea2(k ,m-1)
astk m)=azlk miesfileazik., m-1)
continue

continue

t=tx-1
do 12 j=2,jx-]

if(sfizx eq. li. isfizmer(ix-Tpleblix-TjlZ(r lin, pleblix«, jg)
kK1=i-lel(jpe2)atix-2)
kK2=j-lel(puw-2)e(t-2)
k=, 5e(1+iswlhtk te St(t-iswltk2
do 12 m=2,8,3
alik mizall(k mlesfizxtall(k mei)
a2(k ml=a2(k mlesfizxta2(k mel)
asl(k ml=ast(k miesfizxtas(k, mol)
continue
continue

t=2

do 2% jH2,jxn-1
kilsi-le(j-2)alix-2)
k2=j-1e(jx-2)8(1-2)
k=, 5Se(TeiswltkK1¢ Sall-iswltk2
do 21) m=1,7,3
attk ,m)=0.
aZzia«,m)=0.,
a3g(k,m)=0.
continue

iste]
do 22 j=2,jx-]
kK1let-Te(j-2)eix-2)
k2=fr-le(jx-2) el i-2)
k=. 5e(1eiswltk1+ S5e(1-itswltk2
do 22 m=3,9,3
atik ,ml=0.
azik,m)=0.
a3(k ,m)=0.
continue

jze
do 31 is2,ix-1
kKisi-le(j-2)elix-2)
kK2=j-1el(jx-2)e(t-2)

=, 5e(1etiswltk1+¢ 58(1l-isw) tk2
do 30 m=4,6
at(k mi=all(k mlesfjltattk m-3)
agik mi=a2(k mlesfjlta2lk ,m-3)
a3(k mi=a3(k m)esfji*adl(k ,m-3)

PAGE 11

30 continue

bI(kK 2)=ebl(k Qlesfplebti(k.1)
31 continue
32 continue

jtjx-l

facS=sfirx
if(sfjrxw.eq.-Ilfac5=facStdvout/dvin
do 35 j=2,ix-1

Kisi-lelj-2) 8 (ix-2)
kK2=j-14+(jpxw-2)e(4-2)

k=. Sel 1etswltki¢ Sa(l-iswltk2

do 34 m=4,6

al(kK mizalt(k mit¢facStat(k ,me3)

a2d(k mi=a2ik miefacS#ta2l(k me3)

as(k mi =azsl(k mlefacSta3(k ,m+3)

34 continue

btik 2)=b1(k 2)efacSsb1(k ,3)
35 continue
40 continue

jze2

do 45 t=2,1x«-]
Rlsi-tel(j-2)alix-2)
kK2sj-teljpxw-2)ali-2)
k=. 5Se(1e+iswltkhl¢ Se(1-iswltk2
do 44 m=4,6
al(k,m-3)
ac(k,m-3)
a3(k,m-3)
44 continue
bi(k,1)=0.
45 continue
jzjx-]
do 48 t=2,ix-!
k1=i-Teljp-2)8lix-2)
kK2=j-leljpx-2)e(i-2)
k= Se(teiswltki+¢ Se(l-iswlak2
do 47 m=4,6
at(k& .m¢+3)=0.
a3(k ,m+3)=0,
a2t{k,me3)}=0,
A7 continue
bili(k,3)s0,
48 continue
return
end

"uouw of

0.
0.
Q.

subroutine comat labar ,nd)

C..s...transforms the elements of the al(k,m! array into into the
c...,. @lements of the compressed column matrix abar which will be
C..... Operated upon by banfac and bansol,

Coseee insert storage cliches here

use param
use fstor
use matrix
use const

dimension abarl(kxp,1)

PAGE

12

10

Kxx=kxp

lenzndtkxp

call beast labar(1,1),0., len)

do 10 k=1,kxx

do 10 m=i,9
Ipt=me((m-1)/3) al thbw-4)
Ip2=Temod(m-1, 3) 8 thbw-1)¢(m-1)73
Ip=.58¢(leiswltlpl+¢ Sel t-iswlttp2
abar(k Ip)=al(k im)

continue

return

end

subroutine right

calculates right hand side vector for both equations,
rhst(k)s2ta2tur(nl-a2txr(n-Tlebie(xiltd-xiln-1))) . and
chs2(kl=2tadexi(n)-a2exiin-Tlebtedxer(il-xr(n-1))).

Insert cliches for storage here
use param
use fstcr
use matrix
use const

do 10 j=2,jx-1

do 10 t=2,ix-1
kK1sti-lelj-2)elix-2)
K2=j-14(jx-2)8(1-2)

k= 5alteiswiltkh 1+ 5#(1-iswltk2
¢1=0.

t2=0,

t3=0.

tt1=0.

tt2=0,

tt3=0.

do 5 m=1,9

ipei-2em-(lm-1)/3)83
Jozj-le(m-11/3
ifl(jfp.eq.l.or.jp.eq.jrxu.or.ip.eq.l.or.ip.eq.izxigo to 5
kpt=ip-lelix-2)8ljp-2)
kp2=jo-ieljx-2)elip-2)
Kp=.58(1eiswltkple 54(1-iswltkpe2
ti=tlea2(k ml &txroolkp)
t2=t2+a3(k mi txrolkp)
ttl=ttleaZl(k ml txioolkp)
tt2=tt2ea3sl(k mi txiolkp)

continue

do 6 mn=1,3

jq=j-2emn
ifljq.,eq.l.or.jq.eq.jrxlgo to 6
kKql=i-lelix-2)8#(jaq-2)
kKq2=ja-leljx-2)eli-2)

kq= 5e(letswltkaql¢ 5a(1-iswiltkag2
t3=t3ebtl(k ,anielxiol(kKql-xioolka))
tt3=tt3ebilk mn} el xrollkaql-xroolkg))
continue
rhst(kl=(2.#t2-tlefaci*t3)
rhs2(k)=2.8tt2-ttlefac2etes

PAGE

13

10

oo eee
a

re

a

110

120
100

oe oe ee

eee 8 6

continue

return

end

subroutine cightvec

calculates right hand side vector for bath equations,
rhslik)=2ta2txr (n)-a2tar(n-Tiebie(xilll-xifn-1))) . and
rhs2lk)sShastni (mn) -a2txt(an-Tiebleder( | d-xr(n-1))

insert cliches for storage her#
use param
use fstor
use matrix
use const

call sscal(kxx,0.,rhs1,1)

call sscal(kxx,0,,rhs2,1)

do 100 m=1,9

mdel=(m-1)/3

ml=m-1

kof fl=-mdel #5em+(mdel-1) 41x

kof f2=(m-(lmdele1)*3-1) lajxe}-24m1+7tmdel

kof f=. Stliciswithof fie Sel i-itsaltkof f2

do 110 k=1,kxx
chst(kl=erhst(kKie2. ¢a3(k mi txrol(kekoff)-a2(k mitxrool(kekoff ]
rhs2l(klerhs2tk lo] btadtk mitxtolkekoffl-a2t(k mi txioolkekoff )
if(m.eq.2.or.m.eg.5,.0r.m.eqg,8igo to 119

go to 100

continue

do 120 k=1,kxx

mbar zm-t-(m/4) 42
rist(k)erhstlk)+factebitk mbar ltlxtolikekoffl-xtoolk+hoff))
rhs2(klerhs2iklefacetbl(k mbar ) tl xrollkekoffl-xroolkekoff) )
continue

return

end

subroutine rig¢idcon

special constants needed for rigid rotor equilibrium.

storeage ciiche here
use param
use const

input for rigid rotor
data echarg/4.8e-10/, en0/1.000*12/, bO/1,0e4/, amass/3,34e-24/
. c@ee/3.e10/, valfk/.4/, fourpi/12.56637/, pi/3.1415926/
enbar/0.e11/
namelist/rotor/bO,beta0 ratrod,valfk,enO,echarg,r0,rwb,enbar
call ddilrotor,2,3,1)}

carg=sart{l,.-betaQ!)

cr Osqz=rOen2
4asq=r0sqt(1.-carg)/betad
cr=.5@lalogll.*¢carg)l-alogi1.-carg))
aa=saqrtlaasq)

re=rebtaa

val f=bO0/lsartlfourpitenOtamass ) }
omege !=echargtbO/lamasstcee)
omegpe=fourpitenOstechargtt2/amass

PAGE

14

10

400
102

101

..uses grafic, graflib and grafcore to make plots of xr vs,
.. space,
..insert cliche for common here
use param
use fstor
use matrix
use const
dimens on ftyl2), ft(5)}, labl2),dumlizx2),ymin(5) ,ymax(5)
c ,dumi(nplt) plot ljrx-1)
data epp/1.e20/
call orgfilelnume)
call pframe
call p100
write(100,102)nume
write(100, 400 }aname
format(/10x, ‘problem identification " ,5a8 )
formati10x, ‘this problem run by ',a8 )
write (100,101) dt, tx,jx,nmmax,lmax,bias,
c fir, sf6,sf8,kplot, kzs,cpuo,cio,syso
c ,xu,xv,bv0,bm1,b6v3
format(////'dt=',e16,.6,4x«,'ix=",18,4«,'jw=', iB/' total time steps
c °'18,4x,
c ‘no. of tterations =',i8,4«,'bias=',f10.5/
c ‘flr *,e16.8,4«,' sf6=' ,e16,8,4x,
c ‘sf&=',e16.8/'kplot=',18,4x,‘kzs=',i8/
c ‘eps time =°',e16.8/
c ‘i-o time =',e16.8/'sys time =',e16.8/3x,'u exponent (xu) =
c ',e16,8/3x,'v exponent (xvl=',e16.8/'bvO=' ,e16.8,4x, bmi="',
c e16.8,4x, bv3=',e16.8/)

omegst=2.tbeta0tomege i tceett2/(omegp2trOsq!
vomegzechargtsart (enOtfourpi /amass!) trOsqt .5/l(betadtcee)
ulixl=(pitvai./(2tomegstaval fi) /(1- 5/7 1ix-1.5))

duzl(ulix)-uOl/tjpx-1.5)

targz=cosh(rwtt2/rOsqecr |} ¥sart (beta)
vi jx) =bOtrOsqt Stalogitarg!/saqrtifourp? |

dvel(vijxul-vOl/tyx-1.5)
return
end

subroutine mymovela.b, len)
dimension all) ,b(1)

do 10 tzi,len

a(t)=zbli)

continue

return

end

subroutine picsher

plot coordinate stretching

“(z=econst’

O OL 0 mt we oe
MW ee e< x
~—— Te i
—_~ Gy— —

time and

